```
__        ___  _____ _____ ____  ___ _   _ ____       _________  
\ \      / / \|_   _| ____|  _ \|_ _| | | / ___|     |___ /___ \ 
 \ \ /\ / / _ \ | | |  _| | |_) || || | | \___ \ _____ |_ \ __) |
  \ V  V / ___ \| | | |___|  _ < | || |_| |___) |_____|__) / __/ 
   \_/\_/_/   \_\_| |_____|_| \_\___|\___/|____/     |____/_____|
   
```
# Познавательно-исследовательский проект

### Цель экспиремента
Перенести логику и наработанные механизмы проекта [Waterius](https://github.com/dontsovcmc/waterius) на моно кристал ESP32.
Основные постулаты:
- Во главе угла проекта долгосрочная автономная работа от элементов питания
- Простота сборки, настройки и управления
- Большое кол-во IO портов для подключения сенсоров
- Управление NB-IOT модемом

### Архитектура

### Проблемы
- Как оказалось, при детальном погружении в тему, не понятно чем питать ESP32. Рекомендации разработчиков 3.3в минимум 500мА источник. Широко распространенные LDO способные отдать такой ток имею высокое потребление по сравнению с потреблением всей схемы в режиме покоя. В интернетах народ не парится, а использует прямое подключение к элементам питания LiFePo4, так себе решение.
- Сопроцессор ULP на котором реализована логика опроса датчиков программируется на ассемблере, очень сильно урезанном ассемблере.
- Как отлаживать асемблерный код ULP?
- В рамках проекта на ULP возложены функции считывания данных с ADC, усреднение значений, инкрементация значений счетчиков, обработка данных с digital датчиков, обработка кнопки управления, пробуждение CPU в случае необходимости. Все эти задачи порождают не малую простынку ассемблерного кода и в конце концов получаем ошибку - 

```
ulp_process_macros_and_load(): program too big: 133 words, max is 128 words
  ERROR     (ULP) : Error loading ULP code!
```

VSCode и Platformio с ардуино фреймворком используют прекомпелированные файлы собраны с параметром CONFIG_ULP_COPROC_RESERVE_MEM 512. Решение с простор интернета [Increase ULP program size](https://www.esp32.com/viewtopic.php?t=7023)

- В момент пробуждения CPU из глубокого сна ULP получает от АЦП некорректные значения [ESP32 ULP ADC sampling glitch during wakeup](https://esp32.com/viewtopic.php?t=7105). Что с этим делать не совсем ясно.

```
ID: 1505         Value: 171
ID: 1506         Value: 171
ID: 1507         Value: 172
ID: 1508         Value: 170
ID: 1509         Value: 172
ID: 1510         Value: 170
ID: 1511         Value: 171
ID: 1512         Value: 4095 <- Bug, while wakeup CPU
ID: 1513         Value: 170
ID: 1514         Value: 169
ID: 1515         Value: 171
ID: 1516         Value: 170
ID: 1517         Value: 170
ID: 1518         Value: 169
ID: 1519         Value: 169
ID: 1520         Value: 168
```

### Результат

### Вывод
Предварительно, в связи с все новыми и новыми открывающимися проблемами и ограничениями платформы ESP32, легаси проект Waterius -  **дешевле, проще, автономнее**. Реализация на ESP32 не целесообразна.